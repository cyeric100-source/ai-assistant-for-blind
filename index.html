<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI è¦–éšœåŠ©ç† (2025 å…¨èƒ½æ’ç‰ˆçµ‚æ¥µç‰ˆ)</title>
    
    <!-- å¼•å…¥ Marked.js è§£æ Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/lib/marked.umd.min.js"></script>
    
    <!-- å¼•å…¥ DOMPurify é€²è¡Œ HTML æ¶ˆæ¯’ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>

    <!-- ã€æ ¸å¿ƒè¨­å®šã€‘PDF.js v5.4.449 : è®€å–æœ¬åœ° pdf-dist è³‡æ–™å¤¾ -->
    <script type="module">
        // ã€å®‰å…¨æ©Ÿåˆ¶ã€‘æœ¬æ©ŸåŸ·è¡Œæª¢æ¸¬èˆ‡é–å®š
        if (window.location.protocol === 'file:') {
            document.documentElement.innerHTML = `
                <body style="background:#000; color:#fff; display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; margin:0; font-family:sans-serif;">
                    <h1 style="color:yellow; font-size:2.5rem; text-align:center;">âš ï¸ ç’°å¢ƒéŒ¯èª¤</h1>
                    <p style="font-size:1.5rem; text-align:center; max-width:800px; line-height:1.6;">
                        ç‚ºäº†ç¢ºä¿åŠŸèƒ½æ­£å¸¸ï¼Œæœ¬ç¨‹å¼<strong>ä¸æ”¯æ´</strong>åœ¨æœ¬æ©Ÿ (Local) ç›´æ¥é–‹å•Ÿã€‚<br><br>
                        è«‹å°‡æ­¤å°ˆæ¡ˆä¸Šå‚³è‡³ <strong>GitHub</strong>ï¼Œä¸¦é€é GitHub Pages æˆ–ç·šä¸Šç¶²å€é–‹å•Ÿä½¿ç”¨ã€‚
                    </p>
                </body>
            `;
            throw new Error("Local execution blocked. Please run on a server.");
        }

        const PDF_BASE = './pdf-dist/pdf.mjs';
        const WORKER_URL = './pdf-dist/pdf.worker.mjs';

        async function initPdfSystem() {
            try {
                const response = await fetch(PDF_BASE, { method: 'HEAD' });
                if (!response.ok) {
                    throw new Error(`æ‰¾ä¸åˆ°æ ¸å¿ƒæª”æ¡ˆ - è«‹ç¢ºèª GitHub å°ˆæ¡ˆä¸­æ˜¯å¦æœ‰ pdf-dist è³‡æ–™å¤¾`);
                }
                const pdfjsLib = await import(PDF_BASE);
                window.pdfjsLib = pdfjsLib;
                pdfjsLib.GlobalWorkerOptions.workerSrc = WORKER_URL;
                console.log("PDF System Initialized");
                window.dispatchEvent(new Event('pdfjs-loaded'));
            } catch (e) {
                console.error("PDF Init Failed:", e);
                window.reportError("PDF æ ¸å¿ƒè¼‰å…¥å¤±æ•—ï¼", e);
            }
        }
        initPdfSystem();
    </script>
    
    <style>
        :root {
            --bg-color: #000000;
            --text-color: #FFFFFF;
            --accent-color: #FFFF00;
            --user-header-color: #0088ff;
            --ai-header-color: #FFFF00;
            --border-color: #555;
            --input-bg: #1A1A1A;
            --button-bg: #FFFF00;
            --button-text: #000000;
            --status-bg: #222;
            --tool-bg: #112233;
            --active-tab-bg: #004488;
            --active-tab-text: #ffffff;
        }

        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 0;
            font-size: 1.2rem; line-height: 1.6;
            padding-top: 60px;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .message-area, #system-prompt, #user-input, input, #error-log-area {
            -webkit-user-select: text;
            user-select: text;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 10px 10px 450px 10px;
        }

        .app-title { font-size: 1.5rem; text-align: center; margin: 10px 0; color: #ccc; font-weight: bold; }
        
        input, select, textarea {
            width: 100%; padding: 12px; margin-top: 5px; margin-bottom: 10px;
            background: var(--input-bg); border: 2px solid var(--border-color);
            color: var(--text-color); font-size: 1.1rem; border-radius: 6px; box-sizing: border-box;
        }

        #system-prompt, #error-log-area { min-height: 150px; resize: vertical; font-family: monospace; }
        
        button {
            background-color: var(--button-bg); color: var(--button-text);
            border: 2px solid #fff; padding: 12px; font-size: 1.1rem; font-weight: bold;
            border-radius: 8px; margin-top: 5px; cursor: pointer;
        }
        button:disabled { filter: grayscale(100%); opacity: 0.7; }
        
        .message {
            background: #111; padding: 15px; margin-bottom: 25px;
            border-left: 5px solid var(--border-color);
            overflow-wrap: break-word;
        }
        .message.user { border-left-color: var(--user-header-color); background: #0a0a1a; }
        .message.assistant { border-left-color: var(--ai-header-color); background: #1a1a0a; }

        .markdown-body h1, .markdown-body h2 { color: #88CCFF; margin-top: 1.5em; }
        .markdown-body table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        .markdown-body th, .markdown-body td { border: 1px solid #555; padding: 8px; text-align: left; }

        .controls-wrapper {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #000; border-top: 3px solid var(--accent-color);
            padding: 10px; z-index: 100;
        }

        #status-bar {
            position: fixed; top: 0; left: 0; right: 0;
            background: var(--status-bg); color: #fff;
            padding: 10px; text-align: center; font-weight: bold;
            border-bottom: 2px solid var(--border-color); z-index: 2000;
        }

        .hidden { display: none !important; }
        .row { display: flex; gap: 10px; margin-bottom: 8px; }
        .check-btn { flex: 1; display: flex; align-items: center; background: #222; padding: 10px; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>

<div id="status-bar" role="status">ç³»çµ±åˆå§‹åŒ–ä¸­...</div>

<div class="container">
    <h1 class="app-title">AI è¦–éšœåŠ©ç† (2025 å…¨èƒ½æ’ç‰ˆçµ‚æ¥µç‰ˆ)</h1>

    <details id="settings-area">
        <summary><h2>è¨­å®š</h2></summary>
        <div>
            <label>AI æœå‹™å•†:</label>
            <select id="provider-select" onchange="handleProviderChange()">
                <option value="gemini">Google Gemini</option>
                <option value="openrouter">OpenRouter</option>
                <option value="openai">OpenAI</option>
            </select>
            <label>API Key:</label>
            <input type="password" id="api-key">
            <label>æ¨¡å‹é¸æ“‡:</label>
            <select id="model-select"></select>
            <button type="button" onclick="saveSettings()">å„²å­˜è¨­å®š</button>
        </div>
    </details>

    <details open style="background:#112233; border:2px solid #005588; padding:10px; border-radius:8px; margin-top:10px;">
        <summary><h2 style="display:inline; color:#88ccff;">PDF æ™ºèƒ½é–±è®€å·¥å…·ç®±</h2></summary>
        <div style="margin-top:15px;">
            <input type="file" id="pdf-tool-input" class="hidden" accept="application/pdf" onchange="handlePDFToolFileSelect()">
            <button type="button" id="pdf-start-btn" style="width:100%;" onclick="document.getElementById('pdf-tool-input').click()" disabled>ğŸ“„ é¸æ“‡ PDF é€²è¡Œå®Œæ•´é–±è®€</button>
            <div class="row" style="margin-top:10px;">
                <label class="check-btn"><input type="checkbox" id="pdf-translate"> <span>ç¿»è­¯æˆç¹é«”ä¸­æ–‡</span></label>
            </div>
        </div>
    </details>

    <div id="chat-output" class="message-area"></div>
</div>

<footer class="controls-wrapper">
    <form onsubmit="handleSubmit(event)">
        <div class="row">
            <input type="file" id="file-input" class="hidden" onchange="handleFileSelect()">
            <button type="button" onclick="document.getElementById('file-input').click()" style="flex:1;">é¸æ“‡æª”æ¡ˆ</button>
            <button type="button" onclick="resetConversation()" style="flex:1; background:#442222; color:white;">æ¸…é™¤å°è©±</button>
        </div>
        <div class="row">
            <button type="button" id="voice-btn" style="height:80px; width:100px;">æŒ‰ä½èªªè©±</button>
            <textarea id="user-input" placeholder="è¼¸å…¥è¨Šæ¯..." rows="3" style="flex:1;"></textarea>
            <button type="submit" style="height:80px; width:80px;">å‚³é€</button>
        </div>
    </form>
</footer>

<script>
    // --- ã€ä¿®æ­£ 1 & 2 & 4ã€‘æ–‡å­—æ’ç‰ˆå¼•æ“ (UniversalTextNormalizer) ---
    class UniversalTextNormalizer {
        static getScriptType(char) {
            if (!char) return 'other';
            const code = char.charCodeAt(0);
            if ((code >= 0x4E00 && code <= 0x9FFF) || (code >= 0xAC00 && code <= 0xD7AF)) return 'cjk';
            if ((code >= 0x0E00 && code <= 0x0E7F)) return 'sea';
            if ((code >= 0x0041 && code <= 0x005A) || (code >= 0x0061 && code <= 0x007A) || (code >= 0x0030 && code <= 0x0039)) return 'latin';
            return 'other';
        }

        // mode: 'pdf' (æ–‡å­—æå–ç‰ˆï¼Œéœ€å¼·åŠ›é»åˆ) / 'ai' (AI OCRç‰ˆï¼Œéœ€ä¿ç•™çµæ§‹)
        static normalize(text, mode = 'pdf') {
            if (!text) return "";
            
            // çµ±ä¸€æ›è¡Œ
            let res = text.replace(/\r\n/g, "\n").replace(/\r/g, "\n");

            // è™•ç†é€£å­—ç¬¦
            res = res.replace(/([a-zA-Z])-\n([a-zA-Z])/g, "$1$2");

            const lines = res.split("\n");
            let processed = "";
            
            for (let i = 0; i < lines.length; i++) {
                let curr = lines[i].trim();
                if (curr.length === 0) { processed += "\n\n"; continue; }
                
                // è¡¨æ ¼ä¿è­·æ©Ÿåˆ¶ï¼šå¦‚æœç•¶å‰è¡Œæˆ–ä¸‹ä¸€è¡ŒåŒ…å«è¡¨æ ¼ç‰¹å¾µï¼Œä¸é€²è¡Œé»åˆ
                const isTable = (line) => line && (line.includes('|') || line.includes('---'));

                if (i < lines.length - 1) {
                    let next = lines[i + 1].trim();
                    if (next.length === 0 || isTable(curr) || isTable(next)) {
                        processed += curr + "\n";
                        continue;
                    }
                    
                    // AI æ¨¡å¼ä¿è­·ï¼šä¸é»åˆ Markdown åˆ—è¡¨æˆ–æ¨™é¡Œ
                    if (mode === 'ai' && (/^[-*â€¢#\d.]/.test(next) || /^[-*â€¢#]/.test(curr))) {
                        processed += curr + "\n";
                        continue;
                    }

                    let lastChar = curr.slice(-1);
                    let nextChar = next.charAt(0);
                    const typeA = this.getScriptType(lastChar);
                    const typeB = this.getScriptType(nextChar);

                    // é»åˆé‚è¼¯
                    if ((typeA === 'cjk' || typeA === 'sea') && (typeB === 'cjk' || typeB === 'sea')) {
                        processed += curr; 
                    } else if ((typeA === 'cjk' && typeB === 'latin') || (typeA === 'latin' && typeB === 'cjk')) {
                         processed += curr;
                    } else {
                        processed += curr + " ";
                    }
                } else {
                    processed += curr;
                }
            }

            // æ¸…ç† CJK å…§éƒ¨çš„å¤šé¤˜ç©ºæ ¼
            processed = processed.replace(/([\u4e00-\u9fff])\s+([\u4e00-\u9fff])/g, "$1$2");
            processed = processed.replace(/([\u4e00-\u9fff])\s+([a-zA-Z0-9])/g, "$1$2");
            processed = processed.replace(/([a-zA-Z0-9])\s+([\u4e00-\u9fff])/g, "$1$2");

            return processed.replace(/\n{3,}/g, "\n\n").trim();
        }
    }

    // --- ã€ä¿®æ­£ 3ã€‘é é¢æ¨™ç±¤å¾Œç½®è™•ç†èˆ‡ PDF è™•ç†æµ ---
    async function performAIProcessing(file, sourceMode, textData, needTranslate) {
        const controller = new AbortController(); 
        let pages = []; // ç”¨ä¾†å­˜å„²æ¯ä¸€é è™•ç†å¾Œçš„ç´”å…§å®¹

        if (sourceMode === "image") {
            let ocrProvider = document.getElementById('provider-select').value;
            let ocrModel = currentActiveModelId;
            let ocrApiKey = document.getElementById('api-key').value;
            
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await window.pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            
            updateStatusBar(`OCR è™•ç†ä¸­ (å…± ${pdf.numPages} é )...`, "busy");
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 2.0 });
                const canvas = document.createElement('canvas');
                canvas.width = viewport.width; canvas.height = viewport.height;
                await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
                
                const imgBase64 = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];
                const rawPageText = await callAI(ocrProvider, "Transcribe the text.", imgBase64, "image/jpeg", controller.signal, ocrModel, ocrApiKey, DEFAULT_OCR_PROMPT);
                
                // åœ–åƒç‰ˆä½¿ç”¨ 'ai' æ¨¡å¼æ’ç‰ˆ
                pages.push(UniversalTextNormalizer.normalize(rawPageText, 'ai'));
                canvas.remove();
            }
        } else {
            // æ–‡å­—ç‰ˆè™•ç†ï¼šå°‡å‚³å…¥çš„ raw text æŒ‰é ç¢¼æ¨™èªŒåˆ†å‰²
            const rawPages = textData.split(/## \[Page \d+\]/);
            pages = rawPages.filter(p => p.trim().length > 0).map(p => UniversalTextNormalizer.normalize(p, 'pdf'));
        }

        // çµ„åˆæœ€çµ‚çµæœï¼šæ­¤æ™‚æ‰åŠ å…¥ Markdown æ¨™é¡Œ2
        let finalOutput = pages.map((content, idx) => `## [Page ${idx + 1}]\n\n${content}`).join('\n\n');

        if (needTranslate) {
            updateStatusBar("æ­£åœ¨ç¿»è­¯å…¨æ–‡...", "busy");
            const transRes = await callAI(document.getElementById('provider-select').value, `[SOURCE]:\n${finalOutput}`, null, null, controller.signal, null, null, DEFAULT_TRANSLATE_PROMPT);
            addMessage('assistant', transRes);
        } else {
            addMessage('assistant', finalOutput);
        }

        updateStatusBar("ä»»å‹™å®Œæˆ", "ready");
        playAudioCue('success');
    }

    // --- é«˜ç´šç‰ˆé¢åˆ†æå¼•æ“ (ä¿®æ­£ç‰ˆ) ---
    class AdvancedLayoutEngine {
        constructor(items, pageWidth) { this.items = items; this.pageWidth = pageWidth; }
        process() {
            const lines = this.groupIntoLines(this.items);
            lines.sort((a, b) => a.y - b.y);
            let result = "";
            let currentBlock = [];
            for (let i = 0; i < lines.length; i++) {
                currentBlock.push(lines[i]);
                const nextLine = lines[i+1];
                if (!nextLine || (nextLine.y - lines[i].y > lines[i].avgHeight * 2.5)) {
                    if (this.isTableBlock(currentBlock)) { result += this.renderMarkdownTable(currentBlock) + "\n\n"; }
                    else { result += this.renderParagraphs(currentBlock) + "\n"; }
                    currentBlock = [];
                }
            }
            return result;
        }
        groupIntoLines(items) {
            const lines = [];
            items.sort((a, b) => a.y - b.y);
            items.forEach(item => {
                const match = lines.find(l => Math.abs(l.y - item.y) < item.fontHeight * 0.5);
                if (match) { match.items.push(item); match.count++; }
                else { lines.push({ y: item.y, avgHeight: item.fontHeight, count: 1, items: [item] }); }
            });
            lines.forEach(l => l.items.sort((a, b) => a.x - b.x));
            return lines;
        }
        isTableBlock(lines) {
            if (lines.length < 2) return false;
            let maxItems = Math.max(...lines.map(l => l.items.length));
            return maxItems > 2; // ç°¡å–®åˆ¤å®šï¼šä¸€è¡Œè¶…éå…©å€‹å…ƒç´ å¯èƒ½æ˜¯è¡¨æ ¼
        }
        renderMarkdownTable(lines) {
            let md = "";
            lines.forEach((line, idx) => {
                let row = line.items.map(it => it.str.replace(/\|/g, '\\|')).join(' | ');
                md += `| ${row} |\n`;
                if (idx === 0) { 
                    md += `| ${line.items.map(() => '---').join(' | ')} |\n`;
                }
            });
            return md;
        }
        renderParagraphs(lines) {
            return lines.map(l => l.items.map(it => it.str).join('')).join('\n');
        }
    }

    // --- PDF æ–‡å­—æå– (ä¿®æ­£ç‰ˆ) ---
    async function extractTextFromPDF_Accurate(file) {
        try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await window.pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = "";
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                const viewport = page.getViewport({ scale: 1.0 });
                let items = content.items.map(item => ({
                    str: item.str,
                    x: item.transform[4],
                    y: viewport.height - item.transform[5],
                    w: item.width,
                    fontHeight: Math.abs(item.transform[3])
                }));
                const engine = new AdvancedLayoutEngine(items, viewport.width);
                // é€™è£¡æš«æ™‚åŠ å…¥æ¨™è¨˜ä»¥ä¾¿å¾ŒçºŒ performAIProcessing åˆ†é 
                fullText += `## [Page ${i}]\n${engine.process()}\n\n`;
            }
            return fullText;
        } catch (e) { return null; }
    }

    // --- åŸºç¤ç³»çµ±å‡½æ•¸ ---
    const DEFAULT_CHAT_PROMPT = "ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„åŠ©ç†ã€‚è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›ç­”ã€‚";
    const DEFAULT_OCR_PROMPT = "è«‹ç²¾ç¢ºè½‰éŒ„åœ–ç‰‡ä¸­çš„æ‰€æœ‰æ–‡å­—ï¼Œä¿æŒåŸå§‹æ ¼å¼ï¼Œä¸è¦ç¸½çµã€‚";
    const DEFAULT_TRANSLATE_PROMPT = "è«‹å°‡ä»¥ä¸‹æ–‡å­—ç¿»è­¯æˆç¹é«”ä¸­æ–‡ï¼ˆé¦™æ¸¯æ…£ç”¨èªï¼‰ï¼Œä¿ç•™æ‰€æœ‰ Markdown æ¨™ç±¤å’Œé ç¢¼æ¨™è¨˜ã€‚";
    const PROVIDERS = {
        gemini: { models: ["gemini-2.0-flash", "gemini-1.5-pro"] },
        openrouter: { models: ["google/gemini-2.0-flash-001", "openai/gpt-4o"] },
        openai: { models: ["gpt-4o", "gpt-4o-mini"] }
    };
    let currentActiveModelId = "";
    let selectedFile = null;

    window.reportError = (m, e) => { document.getElementById('status-bar').innerText = m; console.error(e); };

    function handleProviderChange() {
        const p = document.getElementById('provider-select').value;
        const s = document.getElementById('model-select');
        s.innerHTML = "";
        PROVIDERS[p].models.forEach(m => {
            const o = document.createElement('option'); o.value = m; o.innerText = m; s.appendChild(o);
        });
        currentActiveModelId = s.value;
    }

    function saveSettings() {
        localStorage.setItem('api_key', document.getElementById('api-key').value);
        currentActiveModelId = document.getElementById('model-select').value;
        alert("è¨­å®šå·²å„²å­˜");
    }

    function updateStatusBar(t, s = 'ready') {
        const b = document.getElementById('status-bar');
        b.innerText = t; b.style.background = s === 'busy' ? '#664400' : '#222';
    }

    function addMessage(role, content) {
        const div = document.createElement('div');
        div.className = `message ${role}`;
        div.innerHTML = `<div class="markdown-body">${DOMPurify.sanitize(marked.parse(content))}</div>`;
        document.getElementById('chat-output').appendChild(div);
        div.scrollIntoView();
        return div;
    }

    async function callAI(p, txt, file, mime, sig, ovModel, ovKey, sys) {
        const k = ovKey || document.getElementById('api-key').value;
        const m = ovModel || currentActiveModelId;
        if (!k) throw new Error("ç¼ºå°‘ API Key");
        
        let url, body, headers = { 'Content-Type': 'application/json' };
        if (p === 'gemini') {
            url = `https://generativelanguage.googleapis.com/v1beta/models/${m}:generateContent?key=${k}`;
            body = { system_instruction: { parts: [{ text: sys }] }, contents: [{ role: "user", parts: file ? [{ inline_data: { mime_type: mime, data: file } }, { text: txt }] : [{ text: txt }] }] };
        } else {
            url = p === 'openai' ? "https://api.openai.com/v1/chat/completions" : "https://openrouter.ai/api/v1/chat/completions";
            headers['Authorization'] = `Bearer ${k}`;
            body = { model: m, messages: [{ role: "system", content: sys }, { role: "user", content: txt }], temperature: 0.3 };
        }
        const r = await fetch(url, { method: 'POST', headers, body: JSON.stringify(body), signal: sig });
        const d = await r.json();
        return p === 'gemini' ? d.candidates[0].content.parts[0].text : d.choices[0].message.content;
    }

    function handlePDFToolFileSelect() {
        const f = document.getElementById('pdf-tool-input').files[0];
        if (f) processPDFTool(f);
    }

    async function processPDFTool(file) {
        updateStatusBar("æ­£åœ¨è®€å– PDF...", "busy");
        const rawText = await extractTextFromPDF_Accurate(file);
        const needTrans = document.getElementById('pdf-translate').checked;
        
        // å¦‚æœæå–çš„æ–‡å­—å¤ªå°‘ï¼Œè‡ªå‹•åˆ‡æ›åˆ° OCR æ¨¡å¼
        if (!rawText || rawText.replace(/\s/g, '').length < 100) {
            await performAIProcessing(file, "image", null, needTrans);
        } else {
            await performAIProcessing(file, "text", rawText, needTrans);
        }
    }

    function handleFileSelect() {
        selectedFile = document.getElementById('file-input').files[0];
        alert("å·²é¸æ“‡æª”æ¡ˆ: " + selectedFile.name);
    }

    async function handleSubmit(e) {
        e.preventDefault();
        const txt = document.getElementById('user-input').value;
        if (!txt && !selectedFile) return;
        
        updateStatusBar("AI æ€è€ƒä¸­...", "busy");
        addMessage('user', txt || "[ä¸Šå‚³æª”æ¡ˆ]");
        
        try {
            const res = await callAI(document.getElementById('provider-select').value, txt, null, null, null, null, null, DEFAULT_CHAT_PROMPT);
            addMessage('assistant', res);
            document.getElementById('user-input').value = "";
        } catch (err) {
            reportError("å‚³é€å¤±æ•—", err);
        } finally {
            updateStatusBar("æº–å‚™å°±ç·’", "ready");
        }
    }

    function resetConversation() {
        document.getElementById('chat-output').innerHTML = "";
        updateStatusBar("å°è©±å·²æ¸…é™¤");
    }

    function playAudioCue(type) {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain); gain.connect(ctx.destination);
        osc.start(); osc.stop(ctx.currentTime + 0.2);
    }

    window.addEventListener('pdfjs-loaded', () => {
        document.getElementById('pdf-start-btn').disabled = false;
        updateStatusBar("æº–å‚™å°±ç·’");
        handleProviderChange();
    });
</script>
</body>
</html>